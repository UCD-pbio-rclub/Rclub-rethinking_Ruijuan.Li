---
title: "Chapter-12-assignment-03"
author: "Ruijuan Li"
date: "12/1/2016"
output: 
  html_document: 
    keep_md: yes
---

# 12H2 
```{r}
# Return to the Trolley data, data(Trolley), from Chapter 11. Define and fit a varying intercepts model for these data. Cluster intercepts on individual participants, as indicated by the unique values in the id variable. Include action, intention, and contact as ordinary terms. Compare the varying intercepts model and a model that ignores individuals, using both WAIC and posterior predictions. What is the impact of individual variation in these data? 

library(rethinking)
data("Trolley")
d <- Trolley
head(Trolley)
length(unique(Trolley$id)) # 331 individuals 
dim(Trolley)

# fit the original model 
m12H2.1 <- map(
  alist(
    response ~ dordlogit(phi, c(a1,a2,a3,a4,a5,a6)), 
    phi <- bA*action + bI*intention + bC*contact, 
    c(bA,bI,bC) ~ dnorm(0,10), 
    c(a1,a2,a3,a4,a5,a6) ~ dnorm(0,10)
  ), 
  data = d,
  start = list(a1=-1.9, a2=-1.2, a3=-0.7, a4=0.2, a5=0.9, a6=1.8)
)

# fit multilevel intercept model 
mean(d$response)
m12H2.2 <- map(
  alist(
    response ~ dordlogit(phi, c(a1,a2,a3,a4,a5,a6)), 
    phi <- a_id[id] + bA*action + bI*intention + bC*contact, 
    a_id[id] ~ dnorm(5, 10), 
    c(bA,bI,bC) ~ dnorm(0,10), 
    c(a1,a2,a3,a4,a5,a6) ~ dnorm(0,10)
  ), 
  data = d, 
  start = list(a1=-1.9, a2=-1.2, a3=-0.7, a4=0.2, a5=0.9, a6=1.8) 
) 

# compare two models using both WAIC & posterior prediction 
precis(m12H2.1)
#     Mean StdDev  5.5% 94.5%
# a1 -2.84   0.05 -2.91 -2.76
# a2 -2.15   0.04 -2.22 -2.09
# a3 -1.57   0.04 -1.63 -1.51
# a4 -0.55   0.04 -0.61 -0.49
# a5  0.12   0.04  0.06  0.18
# a6  1.02   0.04  0.96  1.09
# bA -0.71   0.04 -0.77 -0.64
# bI -0.72   0.04 -0.78 -0.66
# bC -0.96   0.05 -1.04 -0.88

precis(m12H2.2) 
#           Mean StdDev  5.5% 94.5%
# a1         0.84   0.55 -0.03  1.72
# a2         1.78   0.55  0.91  2.66
# a3         2.57   0.55  1.70  3.45
# a4         4.07   0.55  3.20  4.94
# a5         5.13   0.55  4.26  6.00
# a6         6.58   0.55  5.70  7.45
# a_id[1]    4.28   0.61  3.30  5.26
# a_id[2]    3.06   0.69  1.97  4.16
# a_id[3]    1.82   0.68  0.74  2.90
# a_id[4]    4.45   0.72  3.29  5.60
# a_id[5]    1.32   0.69  0.21  2.42
# a_id[6]    5.53   0.63  4.53  6.54
# a_id[7]    4.36   0.63  3.36  5.37
# a_id[8]    9.05   0.75  7.86 10.24
# a_id[9]    3.98   0.62  2.98  4.97
# a_id[10]   5.70   0.63  4.70  6.70
# a_id[11]   5.49   0.63  4.48  6.50
# a_id[12]   7.39   0.66  6.34  8.45
# a_id[13]   4.43   0.62  3.44  5.41
# a_id[14]   3.80   0.63  2.79  4.81
# a_id[15]   6.55   0.63  5.55  7.55
# a_id[16]   2.96   0.69  1.86  4.07
# a_id[17]   6.63   0.72  5.48  7.79
# a_id[18]   3.67   0.65  2.63  4.71
# a_id[19]   3.50   0.63  2.50  4.50
# a_id[20]   4.32   0.61  3.34  5.31
# a_id[21]   2.67   0.64  1.65  3.69
# a_id[22]   4.83   0.66  3.78  5.88
# a_id[23]  -0.81   0.91 -2.27  0.65
# a_id[24]   3.16   0.62  2.16  4.15
# a_id[25]   4.17   0.63  3.16  5.18
# a_id[26]   5.86   0.63  4.85  6.87
# a_id[27]   6.11   0.70  4.98  7.23
# a_id[28]   4.03   0.64  3.01  5.04
# a_id[29]   6.11   0.63  5.10  7.12
# a_id[30]   6.59   0.63  5.58  7.60
# a_id[31]   8.85   0.70  7.72  9.97
# a_id[32]   4.09   0.62  3.10  5.09
# a_id[33]   4.66   0.62  3.67  5.65
# a_id[34]   2.95   0.63  1.94  3.96
# a_id[35]   6.30   0.63  5.30  7.30
# a_id[36]   6.53   0.61  5.55  7.51
# a_id[37]   6.15   0.70  5.03  7.26
# a_id[38]   5.54   0.62  4.56  6.53
# a_id[39]   6.11   0.64  5.09  7.13
# a_id[40]   6.20   0.66  5.15  7.25
# a_id[41]   4.05   0.62  3.06  5.03
# a_id[42]   6.64   0.62  5.65  7.63
# a_id[43]   6.67   0.62  5.68  7.65
# a_id[44]   5.05   0.63  4.05  6.06
# a_id[45]   5.63   0.63  4.63  6.63
# a_id[46]   6.95   0.64  5.93  7.98
# a_id[47]   6.99   0.62  6.00  7.97
# a_id[48]   7.33   0.63  6.33  8.34
# a_id[49]   2.88   0.61  1.90  3.86
# a_id[50]   6.13   0.63  5.13  7.12
# a_id[51]   4.44   0.65  3.40  5.49
# a_id[52]   5.54   0.62  4.56  6.53
# a_id[53]   2.32   0.69  1.21  3.42
# a_id[54]   4.41   0.64  3.39  5.43
# a_id[55]   6.94   0.62  5.96  7.93
# a_id[56]   8.95   0.70  7.82 10.07
# a_id[57]   4.72   0.65  3.68  5.76
# a_id[58]   3.38   0.62  2.38  4.37
# a_id[59]   2.31   0.68  1.23  3.40
# a_id[60]   3.67   0.63  2.67  4.67
# a_id[61]   3.61   0.62  2.62  4.60
# a_id[62]   5.20   0.62  4.21  6.19
# a_id[63]   3.27   0.61  2.29  4.24
# a_id[64]   4.54   0.62  3.55  5.54
# a_id[65]   3.89   0.71  2.76  5.02
# a_id[66]   9.86   0.82  8.55 11.17
# a_id[67]   5.06   0.62  4.07  6.06
# a_id[68]   7.21   0.65  6.17  8.25
# a_id[69]   8.34   0.68  7.26  9.42
# a_id[70]   3.91   0.61  2.93  4.90
# a_id[71]   5.34   0.62  4.35  6.32
# a_id[72]   6.04   0.72  4.90  7.19
# a_id[73]   6.90   0.62  5.92  7.89
# a_id[74]   5.90   0.63  4.89  6.90
# a_id[75]   5.58   0.64  4.56  6.60
# a_id[76]   8.58   0.67  7.50  9.65
# a_id[77]   4.95   0.63  3.94  5.95
# a_id[78]   5.06   0.63  4.05  6.07
# a_id[79]   5.85   0.68  4.77  6.93
# a_id[80]   5.28   0.65  4.24  6.31
# a_id[81]   3.21   0.71  2.06  4.35
# a_id[82]   5.95   0.64  4.92  6.97
# a_id[83]   0.71   0.72 -0.44  1.87
# a_id[84]   5.97   0.64  4.95  6.99
# a_id[85]   6.35   0.68  5.27  7.44
# a_id[86]   3.51   0.64  2.49  4.53
# a_id[87]   7.77   0.70  6.66  8.89
# a_id[88]   4.67   0.62  3.68  5.67
# a_id[89]   3.73   0.62  2.73  4.72
# a_id[90]   4.81   0.65  3.77  5.85
# a_id[91]   5.63   0.65  4.60  6.67
# a_id[92]   5.16   0.63  4.15  6.16
# a_id[93]  10.43   0.91  8.97 11.89
# a_id[94]   5.64   0.62  4.65  6.63
# a_id[95]   7.19   0.72  6.03  8.35
# a_id[96]   6.27   0.62  5.27  7.27
# a_id[97]   6.10   0.66  5.04  7.15
# a_id[98]   3.59   0.64  2.57  4.61
# a_id[99]   5.47   0.61  4.48  6.45
# a_id[100]  4.42   0.62  3.43  5.40
# a_id[101]  3.02   0.62  2.02  4.01
# a_id[102] 11.24   1.13  9.44 13.05
# a_id[103]  3.78   0.62  2.79  4.76
# a_id[104]  2.78   0.64  1.77  3.80
# a_id[105]  3.18   0.63  2.17  4.20
# a_id[106]  5.02   0.62  4.03  6.01
# a_id[107]  4.06   0.65  3.02  5.10
# a_id[108]  4.75   0.63  3.75  5.76
# a_id[109]  4.58   0.63  3.56  5.59
# a_id[110]  4.65   0.63  3.65  5.65
# a_id[111]  3.83   0.65  2.79  4.87
# a_id[112]  0.64   0.75 -0.55  1.84
# a_id[113]  6.75   0.63  5.75  7.75
# a_id[114]  5.41   0.62  4.42  6.40
# a_id[115]  3.28   0.64  2.25  4.31
# a_id[116]  5.79   0.63  4.78  6.80
# a_id[117]  5.55   0.64  4.53  6.57
# a_id[118]  3.21   0.67  2.14  4.28
# a_id[119]  2.01   0.71  0.87  3.14
# a_id[120]  3.12   0.63  2.11  4.13
# a_id[121]  4.62   0.63  3.62  5.62
# a_id[122]  3.93   0.63  2.93  4.94
# a_id[123]  5.86   0.62  4.87  6.86
# a_id[124]  3.96   0.62  2.97  4.94
# a_id[125]  3.03   0.62  2.05  4.02
# a_id[126]  4.46   0.62  3.47  5.44
# a_id[127]  6.85   0.63  5.85  7.85
# a_id[128]  5.60   0.63  4.59  6.60
# a_id[129]  3.46   0.63  2.46  4.47
# a_id[130]  3.71   0.65  2.67  4.74
# a_id[131]  5.56   0.62  4.56  6.56
# a_id[132]  6.31   0.64  5.29  7.34
# a_id[133]  5.79   0.64  4.77  6.81
# a_id[134]  3.77   0.67  2.69  4.84
# a_id[135]  5.15   0.62  4.16  6.14
# a_id[136]  3.95   0.62  2.96  4.94
# a_id[137]  4.58   0.65  3.54  5.62
# a_id[138]  2.59   0.72  1.44  3.74
# a_id[139]  3.50   0.64  2.47  4.53
# a_id[140]  5.32   0.68  4.23  6.41
# a_id[141] 13.83   3.33  8.51 19.16
# a_id[142]  5.37   0.62  4.38  6.35
# a_id[143]  1.06   0.68 -0.03  2.15
# a_id[144]  1.85   0.66  0.80  2.90
# a_id[145] 10.00   0.82  8.69 11.32
# a_id[146]  3.73   0.62  2.75  4.72
# a_id[147]  9.87   0.82  8.56 11.19
# a_id[148]  9.06   0.72  7.91 10.20
# a_id[149]  4.95   0.63  3.95  5.95
# a_id[150]  4.37   0.63  3.37  5.37
# a_id[151]  3.42   0.64  2.40  4.45
# a_id[152]  6.78   0.61  5.80  7.76
# a_id[153]  4.81   0.66  3.76  5.87
# a_id[154]  2.34   0.67  1.27  3.40
# a_id[155]  7.54   0.68  6.46  8.63
# a_id[156]  3.19   0.62  2.20  4.19
# a_id[157]  4.85   0.63  3.84  5.85
# a_id[158]  5.95   0.62  4.97  6.94
# a_id[159]  3.93   0.62  2.94  4.92
# a_id[160]  5.69   0.61  4.72  6.67
# a_id[161]  3.59   0.62  2.60  4.59
# a_id[162]  5.82   0.65  4.78  6.86
# a_id[163]  3.19   0.63  2.18  4.20
# a_id[164]  6.86   0.61  5.88  7.85
# a_id[165]  8.12   0.65  7.07  9.17
# a_id[166]  4.70   0.63  3.70  5.70
# a_id[167]  5.68   0.62  4.69  6.66
# a_id[168]  4.56   0.61  3.57  5.54
# a_id[169]  4.94   0.62  3.94  5.94
# a_id[170]  5.55   0.63  4.55  6.56
# a_id[171]  5.22   0.62  4.23  6.22
# a_id[172]  5.11   0.62  4.11  6.11
# a_id[173]  4.33   0.63  3.32  5.34
# a_id[174]  6.99   0.62  6.01  7.97
# a_id[175]  3.80   0.62  2.80  4.79
# a_id[176]  4.30   0.62  3.31  5.29
# a_id[177]  4.79   0.62  3.80  5.78
# a_id[178]  6.11   0.62  5.11  7.11
# a_id[179]  5.59   0.62  4.60  6.58
# a_id[180]  7.27   0.65  6.23  8.30
# a_id[181]  3.38   0.66  2.32  4.44
# a_id[182] 10.55   0.91  9.10 12.01
# a_id[183]  4.36   0.62  3.37  5.34
# a_id[184]  4.08   0.62  3.10  5.07
# a_id[185]  6.03   0.77  4.80  7.26
# a_id[186]  1.44   0.71  0.31  2.58
# a_id[187]  2.50   0.63  1.49  3.50
# a_id[188]  6.30   0.63  5.29  7.31
# a_id[189]  5.86   0.63  4.86  6.87
# a_id[190]  6.29   0.62  5.30  7.28
# a_id[191]  4.25   0.62  3.26  5.24
# a_id[192]  5.15   0.63  4.15  6.15
# a_id[193]  7.12   0.70  6.00  8.24
# a_id[194]  3.48   0.64  2.46  4.50
# a_id[195]  2.97   0.63  1.96  3.98
# a_id[196]  3.17   0.65  2.13  4.20
# a_id[197]  5.61   0.62  4.61  6.60
# a_id[198]  6.40   0.63  5.38  7.41
# a_id[199]  4.11   0.62  3.12  5.09
# a_id[200]  3.95   0.64  2.93  4.97
# a_id[201]  7.64   0.69  6.53  8.75
# a_id[202]  7.45   0.68  6.37  8.53
# a_id[203]  4.40   0.64  3.37  5.43
# a_id[204]  4.73   0.64  3.71  5.75
# a_id[205]  4.09   0.61  3.11  5.07
# a_id[206]  2.85   0.66  1.79  3.91
# a_id[207]  2.66   0.62  1.68  3.65
# a_id[208]  4.26   0.62  3.26  5.25
# a_id[209]  4.11   0.64  3.09  5.14
# a_id[210]  5.55   0.62  4.56  6.53
# a_id[211]  5.08   0.65  4.05  6.11
# a_id[212]  5.23   0.65  4.20  6.27
# a_id[213]  4.20   0.65  3.17  5.24
# a_id[214]  3.25   0.63  2.24  4.26
# a_id[215]  3.35   0.61  2.38  4.33
# a_id[216]  5.35   0.67  4.27  6.42
# a_id[217]  6.15   0.62  5.16  7.14
# a_id[218]  1.37   0.67  0.31  2.44
# a_id[219]  2.87   0.62  1.87  3.86
# a_id[220]  5.35   0.62  4.37  6.34
# a_id[221]  4.86   0.64  3.83  5.89
# a_id[222]  4.00   0.62  3.00  4.99
# a_id[223] 13.75   3.21  8.61 18.88
# a_id[224]  3.49   0.68  2.40  4.59
# a_id[225]  4.89   0.67  3.82  5.96
# a_id[226]  5.98   0.63  4.97  6.99
# a_id[227]  3.10   0.64  2.07  4.13
# a_id[228]  4.46   0.62  3.47  5.44
# a_id[229]  4.54   0.63  3.53  5.55
# a_id[230]  3.88   0.62  2.90  4.86
# a_id[231]  1.96   0.68  0.87  3.06
# a_id[232]  4.75   0.79  3.48  6.01
# a_id[233]  2.52   0.65  1.48  3.55
# a_id[234]  4.78   0.64  3.76  5.79
# a_id[235] 10.11   0.82  8.80 11.42
# a_id[236]  3.02   0.62  2.03  4.00
# a_id[237]  2.50   0.65  1.45  3.54
# a_id[238]  4.26   0.62  3.27  5.25
# a_id[239]  4.55   0.62  3.55  5.54
# a_id[240]  3.92   0.62  2.93  4.91
# a_id[241]  3.85   0.62  2.85  4.84
# a_id[242]  4.58   0.62  3.59  5.57
# a_id[243]  6.92   0.62  5.93  7.90
# a_id[244]  3.45   0.63  2.44  4.46
# a_id[245]  4.40   0.63  3.40  5.40
# a_id[246]  4.15   0.62  3.17  5.14
# a_id[247]  3.13   0.62  2.15  4.12
# a_id[248]  4.35   0.63  3.35  5.35
# a_id[249]  3.55   0.68  2.46  4.64
# a_id[250]  5.19   0.63  4.19  6.20
# a_id[251]  4.80   0.65  3.76  5.84
# a_id[252]  2.21   0.63  1.20  3.22
# a_id[253]  4.56   0.62  3.58  5.55
# a_id[254]  5.34   0.64  4.32  6.36
# a_id[255]  3.17   0.63  2.17  4.17
# a_id[256]  3.72   0.63  2.72  4.72
# a_id[257]  0.50   0.75 -0.70  1.70
# a_id[258]  0.52   0.75 -0.67  1.71
# a_id[259]  3.84   0.62  2.85  4.84
# a_id[260] 11.16   1.13  9.36 12.97
# a_id[261]  1.56   0.71  0.42  2.70
# a_id[262]  4.55   0.62  3.56  5.54
# a_id[263]  1.90   0.67  0.83  2.96
# a_id[264]  5.15   0.62  4.15  6.14
# a_id[265]  6.32   0.62  5.33  7.31
# a_id[266]  5.25   0.62  4.27  6.24
# a_id[267]  4.13   0.63  3.12  5.13
# a_id[268]  5.73   0.64  4.72  6.75
# a_id[269]  6.93   0.62  5.93  7.92
# a_id[270]  1.96   0.63  0.95  2.97
# a_id[271]  6.08   0.66  5.02  7.13
# a_id[272] 10.43   0.91  8.97 11.89
# a_id[273]  3.61   0.64  2.58  4.63
# a_id[274]  5.36   0.62  4.38  6.35
# a_id[275]  5.12   0.63  4.11  6.14
# a_id[276]  3.92   0.62  2.93  4.91
# a_id[277]  3.73   0.63  2.72  4.74
# a_id[278]  3.46   0.64  2.44  4.48
# a_id[279]  3.48   0.64  2.45  4.50
# a_id[280]  4.25   0.63  3.25  5.26
# a_id[281]  3.73   0.65  2.69  4.77
# a_id[282]  4.45   0.63  3.45  5.45
# a_id[283]  6.27   0.62  5.28  7.25
# a_id[284]  7.10   0.65  6.06  8.14
# a_id[285]  3.92   0.63  2.92  4.92
# a_id[286]  1.29   0.70  0.17  2.42
# a_id[287]  3.96   0.62  2.96  4.95
# a_id[288]  2.76   0.68  1.67  3.84
# a_id[289]  5.74   0.61  4.76  6.72
# a_id[290]  3.04   0.63  2.04  4.05
# a_id[291]  3.68   0.62  2.68  4.68
# a_id[292]  6.78   0.65  5.74  7.82
# a_id[293]  4.73   0.63  3.73  5.73
# a_id[294]  9.01   0.73  7.85 10.18
# a_id[295]  4.13   0.65  3.09  5.17
# a_id[296]  5.08   0.62  4.08  6.08
# a_id[297]  2.92   0.63  1.91  3.93
# a_id[298]  4.54   0.62  3.55  5.53
# a_id[299]  7.72   0.66  6.67  8.78
# a_id[300]  5.90   0.62  4.91  6.89
# a_id[301] 10.38   0.91  8.92 11.83
# a_id[302]  5.18   0.65  4.15  6.22
# a_id[303]  4.93   0.63  3.91  5.94
# a_id[304]  4.49   0.66  3.43  5.55
# a_id[305]  4.42   0.61  3.44  5.40
# a_id[306]  4.13   0.63  3.12  5.14
# a_id[307]  4.54   0.63  3.53  5.54
# a_id[308]  6.62   0.74  5.44  7.80
# a_id[309]  4.81   0.64  3.79  5.83
# a_id[310]  7.62   0.64  6.60  8.64
# a_id[311]  5.93   0.64  4.91  6.94
# a_id[312]  5.49   0.64  4.47  6.52
# a_id[313]  3.33   0.65  2.29  4.36
# a_id[314]  3.51   0.63  2.51  4.51
# a_id[315]  4.00   0.64  2.98  5.01
# a_id[316]  6.44   0.62  5.44  7.43
# a_id[317]  4.07   0.63  3.06  5.07
# a_id[318]  4.04   0.64  3.02  5.06
# a_id[319]  4.51   0.62  3.52  5.50
# a_id[320]  3.07   0.64  2.04  4.09
# a_id[321]  3.13   0.64  2.10  4.16
# a_id[322]  9.04   0.70  7.92 10.16
# a_id[323]  5.15   0.64  4.13  6.17
# a_id[324] 13.73   3.19  8.63 18.83
# a_id[325]  3.45   0.77  2.21  4.68
# a_id[326]  5.51   0.63  4.50  6.52
# a_id[327]  4.56   0.63  3.55  5.56
# a_id[328]  6.67   0.63  5.67  7.68
# a_id[329]  3.63   0.62  2.64  4.61
# a_id[330]  1.36   0.70  0.24  2.47
# a_id[331]  4.21   0.66  3.16  5.26
# bA        -0.97   0.04 -1.04 -0.91
# bI        -0.97   0.04 -1.04 -0.91
# bC        -1.30   0.05 -1.38 -1.21


compare(m12H2.1, m12H2.2)
#            WAIC pWAIC  dWAIC weight     SE    dSE
# m12H2.2 31373.1 385.9    0.0      1 186.05     NA
# m12H2.1 37089.8   9.0 5716.7      0  76.08 181.33

```

# 12H3
```{r}

```
